# Hitchcock Dolly Zoom Generator

这是一个用于生成**希区柯克变焦 (Dolly Zoom)** 效果的工具。它能够自动追踪视频中的主体，并应用反向缩放效果，创造出背景压缩或延伸的视觉冲击力。

## ✨ 特性

- **📸 实时预览**：支持调用摄像头实时预览希区柯克变焦效果，辅助拍摄练习。
- **🎮 创意倒放**：支持对**输入素材**或**输出结果**进行倒放处理，轻松实现“推/拉”效果的互转。
- **🚀 高性能**：采用降采样追踪+全分辨率渲染技术，4K 视频也能飞速处理。
- **🎯 智能追踪**：结合 OpenCV GrabCut 和 CSRT 算法，自动锁定并追踪主体。
- **⚖️ 强力防抖**：内置 Kalman 滤波和滑动窗口平滑算法，消除画面抖动。
- **🌐 局域网共享**：启动 Web 服务后自动显示局域网 IP，方便团队通过手机或其他设备访问。

## 🛠️ 环境准备

### 1. 安装 Python 依赖

建议使用 Python 3.8+ 环境：

```bash
pip install -r requirements.txt
```

> **注意**：项目依赖 `opencv-contrib-python` 以使用高级追踪功能，请勿手动安装普通的 `opencv-python`，否则会冲突。

### 2. FFmpeg 环境
本项目内置了 `imageio-ffmpeg`，通常无需手动安装系统级 FFmpeg 即可运行。

## 🚀 运行方法

### 方式一：Web 界面 (推荐)

最全面的功能体验，支持倒放、涂抹选区等高级操作。

```bash
python app.py
```

启动后：
- **本机访问**：终端会显示 `http://127.0.0.1:7860`
- **局域网访问**：终端会显示 `http://192.168.x.x:7860` (同一 WiFi 下的设备可直接访问)

**操作流程：**
1.  **上传视频**：选择你的原始素材。
2.  **(可选) 倒放设置**：
    - 勾选 `倒放输入视频`：如果你是向前走拍摄的，想变成向后退的效果。
    - 勾选 `倒放生成结果`：如果你想让背景的运动方向反转。
3.  **提取与选区**：点击“提取第一帧”，然后在画面上**涂抹**你要追踪的主体。
4.  **生成**：点击“生成效果”，等待大片出炉！

---

### 方式二：实时预览 (Live Preview) 🔥

带着笔记本或使用摄像头，实时体验希区柯克变焦的拍摄感。

```bash
python live_preview.py
```

- 按 **'s'**：暂停画面，框选主体开始追踪。
- 按 **'r'**：重置追踪。
- 按 **'q'**：退出。
- **移动方式**：锁定主体后，人肉前后移动（Dolly In/Out），软件会自动进行变焦（Zoom Out/In）补偿。

---

### 方式三：命令行工具 (CLI)

适合批量处理或快速测试。

```bash
python main.py -i input/your_video.mp4 -o output/result.mp4
```
程序会弹出第一帧，请用鼠标**框选**主体并按 **空格键** 或 **回车键** 确认开始处理。

## 📂 项目结构

- `app.py`: Gradio Web 应用入口 (包含倒放、局域网共享等完整功能)。
- `live_preview.py`: 摄像头实时预览脚本。
- `main.py`: 命令行工具入口。
- `core.py`: 核心算法实现 (DollyZoomProcessor)。
- `requirements.txt`: Python 依赖列表。
